<div class="fixed inset-0 bg-gray-900/50 flex justify-center items-center z-50 p-4"  (click)="onBackdropClick($event)">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-xl p-6"  [class.hidden]="isEditing() || showQrModal()" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">Mesa Seleccionada</h2>
      <button (click)="onClose()" class="text-gray-400 hover:text-gray-600 transition-colors cursor-pointer">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Mesa Info Grid -->
    <div class="grid grid-cols-2 gap-6 mb-6">
      <!-- Left: Info -->
      <div class="space-y-4">
        <div class="bg-gray-50 p-4 rounded-lg">
          <h3 class="text-sm font-medium text-gray-500 mb-1">NÃºmero</h3>
          <p class="text-2xl font-bold text-gray-800">{{table().diningTableNumber}}</p>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg">
          <h3 class="text-sm font-medium text-gray-500 mb-1">Capacidad</h3>
          <p class="text-2xl font-bold text-gray-800">{{table().diningTableCapacity}} personas</p>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg">
          <h3 class="text-sm font-medium text-gray-500 mb-1">Estado</h3>
          <span [class]="getStatusBadgeClass()">
            {{getStatusLabel()}}
          </span>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg">
          <h3 class="text-sm font-medium text-gray-500 mb-1">Forma</h3>
          <p class="text-lg font-semibold text-gray-800 capitalize">{{getShapeLabel()}}</p>
        </div>
      </div>

      <!-- Right: Controls -->
      <div>
        @if (table().tableShape === 'rect') {
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
    <h3 class="text-sm font-semibold text-blue-900 mb-3">Ajustar TamaÃ±o de Barra</h3>

    <!-- Width Control -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">
        Ancho: {{currentWidth}}cm
      </label>
      <div class="flex items-center gap-2">
        <button
          (click)="decreaseWidth()"
          [disabled]="currentWidth <= 60"
          class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
          </svg>
        </button>
        <input
          type="range"
          [(ngModel)]="currentWidth"
          (change)="onSizeChange()"
          min="60"
          max="400"
          step="20"
          class="flex-1 cursor-pointer">
        <button
          (click)="increaseWidth()"
          [disabled]="currentWidth >= 400"
          class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Height Control -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">
        Alto: {{currentHeight}}cm
      </label>
      <div class="flex items-center gap-2">
        <button
          (click)="decreaseHeight()"
          [disabled]="currentHeight <= 60"
          class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
          </svg>
        </button>
        <input
          type="range"
          [(ngModel)]="currentHeight"
          (change)="onSizeChange()"
          min="60"
          max="400"
          step="10"
          class="flex-1 cursor-pointer">
        <button
          (click)="increaseHeight()"
          [disabled]="currentHeight >= 400"
          class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- BotÃ³n de RotaciÃ³n -->
    <button
      (click)="rotateBar()"
      class="w-full px-4 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium cursor-pointer flex items-center justify-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      Rotar Barra 90Â°
    </button>

    <!-- Indicador de orientaciÃ³n -->
    <div class="mt-3 text-center">
      <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
        {{ currentWidth > currentHeight ? 'â†’ Horizontal' : 'â†‘ Vertical' }}
      </span>
    </div>

    <p class="text-xs text-gray-600 mt-3">
      Usa los controles para ajustar el tamaÃ±o de la barra segÃºn tu salÃ³n
    </p>
  </div>
} @else {
  <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 h-full">
    <h3 class="text-sm font-semibold text-indigo-900 mb-3">
      TamaÃ±o de Mesa {{ getShapeLabel() }}
    </h3>

    <div class="grid grid-cols-3 gap-2">
      <button
        (click)="setPresetSize('small')"
        [class.ring-2]="currentWidth === 70"
        [class.ring-indigo-500]="currentWidth === 70"
        [class.bg-indigo-50]="currentWidth === 70"
        class="px-3 py-3 bg-white border-2 border-indigo-200 rounded-lg hover:border-indigo-400 transition-all cursor-pointer">
        <div class="text-center">
          <div class="text-2xl mb-1">ðŸ”µ</div>
          <div class="text-xs font-semibold text-gray-700">PequeÃ±a</div>
          <div class="text-xs text-gray-500">80cm</div>
        </div>
      </button>

      <button
        (click)="setPresetSize('medium')"
        [class.ring-2]="currentWidth === 100"
        [class.ring-indigo-500]="currentWidth === 100"
        [class.bg-indigo-50]="currentWidth === 100"
        class="px-3 py-3 bg-white border-2 border-indigo-200 rounded-lg hover:border-indigo-400 transition-all cursor-pointer">
        <div class="text-center">
          <div class="text-2xl mb-1">ðŸŸ¢</div>
          <div class="text-xs font-semibold text-gray-700">Mediana</div>
          <div class="text-xs text-gray-500">100cm</div>
        </div>
      </button>

      <button
        (click)="setPresetSize('large')"
        [class.ring-2]="currentWidth === 130"
        [class.ring-indigo-500]="currentWidth === 130"
        [class.bg-indigo-50]="currentWidth === 130"
        class="px-3 py-3 bg-white border-2 border-indigo-200 rounded-lg hover:border-indigo-400 transition-all cursor-pointer">
        <div class="text-center">
          <div class="text-2xl mb-1">ðŸŸ </div>
          <div class="text-xs font-semibold text-gray-700">Grande</div>
          <div class="text-xs text-gray-500">120cm</div>
        </div>
      </button>
    </div>

    <p class="text-xs text-gray-600 mt-3 text-center">
      TamaÃ±o actual: <span class="font-semibold text-indigo-700">{{currentWidth}}cm</span>
    </p>
  </div>
}
      </div>
    </div>

    <!-- Actions -->
    <!-- <div class="flex gap-3 pt-4 border-t">
      <button
        (click)="onEdit()"
        class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium cursor-pointer">
        Editar Mesa
      </button>
      <button
        (click)="onRemove()"
        class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium cursor-pointer">
        Eliminar Mesa del SalÃ³n
      </button>
      <button
        (click)="onClose()"
        class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium cursor-pointer">
        Cerrar
      </button>
    </div>
  </div> -->

  <!-- Actions -->
<div class="flex flex-col gap-3 pt-4 border-t">
  <!-- Primera fila: Editar y Eliminar -->
  <div class="flex gap-3">
    <button
      (click)="onEdit()"
      class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium cursor-pointer">
      Editar Mesa
    </button>
    <button
      (click)="onRemove()"
      class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium cursor-pointer">
      Eliminar Mesa del SalÃ³n
    </button>
  </div>

  <!-- Segunda fila: Ver QR y Cerrar -->
  <div class="flex gap-3">
    <button
      (click)="onShowQrCode()"
      class="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium cursor-pointer">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
      </svg>
      Ver CÃ³digo QR
    </button>
    <button
      (click)="onClose()"
      class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium cursor-pointer">
      Cerrar
    </button>
  </div>
</div>
</div>

  <!-- Modal QR -->
@if (showQrModal()) {
  <app-qr-code-modal
    [qrCodeUrl]="qrCodeUrl() ?? ''"
    [tableNumber]="table().diningTableNumber"
    [loading]="qrLoading()"
    [error]="qrError()"
    (close)="onCloseQrModal()"
    (retry)="onRetryQr()">
  </app-qr-code-modal>
}
  @if (isEditing()) {
    <app-edit-table-modal
      [originalTable]="table()"
      (close)="onCloseEditModal()"
      (tableUpdated)="onTableEdited($event)">
    </app-edit-table-modal>
  }

