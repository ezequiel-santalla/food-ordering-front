<section class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-4">

  <!-- Loading state -->
  @if (analyticsData.isLoading()) {
  @for (i of [1,2,3,4]; track i) {
  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm animate-pulse">
    <div class="flex items-center justify-between mb-4">
      <div class="h-4 w-24 bg-gray-200 rounded"></div>
      <div class="h-8 w-8 bg-gray-200 rounded-lg"></div>
    </div>
    <div class="h-8 w-32 bg-gray-200 rounded mb-2"></div>
    <div class="h-4 w-24 bg-gray-200 rounded"></div>
  </div>
  }
  }

  <!-- Error state -->
  @if (analyticsData.error()) {
  <div class="col-span-4 rounded-xl border border-red-200 bg-red-50 p-6">
    <p class="text-red-600 font-medium">Error al cargar los datos</p>
    <button (click)="analyticsData.reload()" class="mt-2 text-sm text-red-700 underline hover:text-red-800">
      Reintentar
    </button>
  </div>
  }

  <!-- Data loaded -->
  @if (analyticsData.value(); as data) {

  <!-- Card 1: Ventas del DÃ­a -->
  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-medium text-gray-500">Ventas</p>
      <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-600">
        <lucide-icon [img]="dollarSignIcon" [size]="16"></lucide-icon>
      </div>
    </div>
    <div>
      <h4 class="text-3xl font-bold text-gray-900 mb-2">
        {{ data.dailySales.value | currency:'ARS':'symbol':'1.2-2' }}
      </h4>
      <div class="flex items-center gap-1 text-sm">
        @if (data.dailySales.change !== 0) {
        <lucide-icon [img]="data.dailySales.isPositive ? trendingUpIcon : trendingDownIcon" [size]="16"
          [class.text-green-600]="data.dailySales.isPositive" [class.text-red-600]="!data.dailySales.isPositive">
        </lucide-icon>
        }
        <span class="font-medium" [class.text-green-600]="data.dailySales.change !== 0 && data.dailySales.isPositive"
          [class.text-red-600]="data.dailySales.change !== 0 && !data.dailySales.isPositive"
          [class.text-gray-500]="data.dailySales.change === 0">
          {{ data.dailySales.change !== 0 && data.dailySales.isPositive ? '+' : '' }}{{ data.dailySales.change }}%
        </span>
        <span class="text-gray-500">{{ data.dailySales.comparisonText }}</span>
      </div>
    </div>
  </div>

  <!-- Card 2: Pedidos -->
  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-medium text-gray-500">Pedidos</p>
      <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-600">
        <lucide-icon [img]="clipboardIcon" [size]="16"></lucide-icon>
      </div>
    </div>
    <div>
      <h4 class="text-3xl font-bold text-gray-900 mb-2">{{ data.totalOrders.value }}</h4>
      <div class="flex items-center gap-1 text-sm">
        @if (data.totalOrders.change !== 0) {
        <lucide-icon [img]="data.totalOrders.isPositive ? trendingUpIcon : trendingDownIcon" [size]="16"
          [class.text-green-600]="data.totalOrders.isPositive" [class.text-red-600]="!data.totalOrders.isPositive">
        </lucide-icon>
        }
        <span class="font-medium" [class.text-green-600]="data.totalOrders.change !== 0 && data.totalOrders.isPositive"
          [class.text-red-600]="data.totalOrders.change !== 0 && !data.totalOrders.isPositive"
          [class.text-gray-500]="data.totalOrders.change === 0">
          {{ data.totalOrders.change !== 0 && data.totalOrders.isPositive ? '+' : '' }}{{ data.totalOrders.change }}%
        </span>
        <span class="text-gray-500">{{ data.totalOrders.comparisonText }}</span>
      </div>
    </div>
  </div>

  <!-- Card 3: Ticket Promedio -->
  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-medium text-gray-500">Ticket Promedio</p>
      <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-600">
        <lucide-icon [img]="usersIcon" [size]="16"></lucide-icon>
      </div>
    </div>
    <div>
      <h4 class="text-3xl font-bold text-gray-900 mb-2">
        {{ data.avgTicket.value | currency:'ARS':'symbol':'1.2-2' }}
      </h4>
      <div class="flex items-center gap-1 text-sm">
        @if (data.avgTicket.change !== 0) {
        <lucide-icon [img]="data.avgTicket.isPositive ? trendingUpIcon : trendingDownIcon" [size]="16"
          [class.text-green-600]="data.avgTicket.isPositive" [class.text-red-600]="!data.avgTicket.isPositive">
        </lucide-icon>
        }
        <span class="font-medium" [class.text-green-600]="data.avgTicket.change !== 0 && data.avgTicket.isPositive"
          [class.text-red-600]="data.avgTicket.change !== 0 && !data.avgTicket.isPositive"
          [class.text-gray-500]="data.avgTicket.change === 0">
          {{ data.avgTicket.change !== 0 && data.avgTicket.isPositive ? '+' : '' }}{{ data.avgTicket.change }}%
        </span>
        <span class="text-gray-500">{{ data.avgTicket.comparisonText }}</span>
      </div>
    </div>
  </div>

  <!-- Card 4: Tiempo Mesa - CORREGIDO -->
  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-medium text-gray-500">Tiempo Mesa</p>
      <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-600">
        <lucide-icon [img]="clockIcon" [size]="16"></lucide-icon>
      </div>
    </div>
    <div>
      <h4 class="text-3xl font-bold text-gray-900 mb-2">{{ data.avgTableTime.value }} min</h4>
      <div class="flex items-center gap-1 text-sm">
        @if (data.avgTableTime.change !== 0) {
        <lucide-icon [img]="data.avgTableTime.isPositive ? trendingUpIcon : trendingDownIcon" [size]="16"
          [class.text-green-600]="data.avgTableTime.isPositive" [class.text-red-600]="!data.avgTableTime.isPositive">
        </lucide-icon>
        }
        <span class="font-medium"
          [class.text-green-600]="data.avgTableTime.change !== 0 && data.avgTableTime.isPositive"
          [class.text-red-600]="data.avgTableTime.change !== 0 && !data.avgTableTime.isPositive"
          [class.text-gray-500]="data.avgTableTime.change === 0">
          {{ data.avgTableTime.change !== 0 && data.avgTableTime.isPositive ? '-' : '+' }}{{ data.avgTableTime.change
          }}%
        </span>
        <span class="text-gray-500">{{ data.avgTableTime.comparisonText }}</span>
      </div>
    </div>
  </div>

  }
</section>
