
<div class="p-4 sm:p-8 min-h-screen bg-gray-50">

  <!-- Header -->
  <header class="mb-6">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Gestión de Pagos</h1>
    <p class="text-sm text-gray-500 mt-1">Administra los pagos de las mesas del restaurante</p>
  </header>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6">
    <!-- Total Pagos -->
    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-gray-400">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs sm:text-sm font-medium text-gray-600">Total Pagos</p>
          <p class="text-xl sm:text-2xl font-bold text-gray-900 mt-1">
            ${{stats().total | number:'1.2-2'}}
          </p>
        </div>
        <lucide-icon [img]="DollarSign" [size]="32" class="text-gray-400"></lucide-icon>
      </div>
    </div>

    <!-- Pagos Completados -->
    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-green-400">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs sm:text-sm font-medium text-gray-600">Pagos Completados</p>
          <p class="text-xl sm:text-2xl font-bold text-green-600 mt-1">
            ${{stats().completed | number:'1.2-2'}}
          </p>
        </div>
        <lucide-icon [img]="CheckCircle2" [size]="32" class="text-green-400"></lucide-icon>
      </div>
    </div>

    <!-- Pendientes -->
    <div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-yellow-400">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs sm:text-sm font-medium text-gray-600">Pendientes</p>
          <p class="text-xl sm:text-2xl font-bold text-yellow-600 mt-1">
            {{stats().pending}}
          </p>
        </div>
        <lucide-icon [img]="CreditCard" [size]="32" class="text-yellow-400"></lucide-icon>
      </div>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
    <div class="flex flex-col sm:flex-row gap-3">

      <!-- Search -->
      <div class="flex-1">
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            placeholder="Buscar por ID o mesa..."
            class="input input-bordered w-full pl-10">
          <lucide-icon
            [img]="Search"
            [size]="20"
            class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
          </lucide-icon>
        </div>
      </div>

      <!-- Status Filter -->
      <select
        [(ngModel)]="selectedStatus"
        (change)="onFilterChange()"
        class="select select-bordered w-full sm:w-48">
        <option value="">Todos los estados</option>
        <option value="PENDING">Pendiente</option>
        <option value="COMPLETED">Completado</option>
        <option value="CANCELLED">Cancelado</option>
      </select>

      <!-- Refresh Button -->
      <button
        (click)="refreshPayments()"
        [disabled]="isLoading"
        class="btn btn-outline gap-2">
        <lucide-icon
          [img]="RefreshCw"
          [size]="20"
          [class.animate-spin]="isLoading">
        </lucide-icon>
        <span class="hidden sm:inline">Actualizar</span>
      </button>
    </div>
  </div>

  <!-- Payments List -->
  @if (isLoading) {
    <div class="flex flex-col items-center justify-center py-12">
      <span class="loading loading-spinner loading-lg text-primary"></span>
      <p class="text-gray-500 mt-4">Cargando pagos...</p>
    </div>
  } @else if (error) {
    <div class="alert alert-error">
      <lucide-icon [img]="AlertCircle" [size]="20"></lucide-icon>
      <span>{{error}}</span>
    </div>
  } @else if (filteredPayments.length === 0) {
    <div class="bg-white rounded-xl shadow-sm p-12">
      <div class="text-center">
        <lucide-icon [img]="CreditCard" [size]="64" class="text-gray-300 mx-auto mb-4"></lucide-icon>
        <p class="text-gray-500 font-medium text-lg mb-2">
          No se encontraron pagos
        </p>
        <p class="text-sm text-gray-400">
          Intenta ajustar los filtros de búsqueda
        </p>
      </div>
    </div>
  } @else {
    <div class="space-y-3">
      @for (payment of filteredPayments; track payment.publicId) {
        <app-payment-card
          [payment]="payment"
          (statusChanged)="onPaymentStatusChanged($event)"
          (viewDetails)="onViewPaymentDetails($event)">
        </app-payment-card>
      }
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
      <app-pagination
        [pages]="totalPages"
        [currentPage]="paginationService.currentPage()">
      </app-pagination>
    }
  }

</div>
