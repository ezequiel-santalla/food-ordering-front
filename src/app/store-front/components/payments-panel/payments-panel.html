<section class="max-w-3xl mx-auto p-4 space-y-4">
  <app-payment-modal
    #payModalCmp
    [totalToPay]="total()"
    [selectedOrders]="selectedOrdersView()"
    [paymentMethods]="paymentMethods"
    [selectedPaymentMethod]="selectedPaymentMethod()"
    [isProcessingPayment]="isProcessingPayment()"
    (paymentMethodChange)="selectedPaymentMethod.set($event)"
    (confirm)="confirmPayment()"
    (cancel)="payModalCmp.close()"
    (mercadoPagoSelected)="selectedPaymentMethod.set(PaymentMethod.MOBILE_PAYMENT)"
  ></app-payment-modal>

  <div class="grid grid-cols-2 gap-2 mb-2">
    <button
      class="btn btn-sm sm:btn-md"
      [class.btn-primary]="active() === 'mine'"
      (click)="setTab('mine')"
    >
      Mis órdenes ({{ unpaidMine().length }})
    </button>

    <button
      class="btn btn-sm sm:btn-md"
      [class.btn-primary]="active() === 'table'"
      (click)="setTab('table')"
    >
      Mesa ({{ unpaidTable().length }})
    </button>
  </div>

  <div class="pb-32">
    <!-- MIS ÓRDENES -->
    @if (active() === 'mine') {

    <!-- IMPAGAS -->
    <h3 class="text-sm font-semibold text-gray-500 mt-2 mb-1">Pendientes</h3>
    <div class="space-y-2">
      @for (order of unpaidMine(); track order.publicId) {
      <app-payable-order-card
        [order]="order"
        [paid]="isPaid(order)"
        [selected]="selectedOrders().includes(order.publicId)"
        (selectionChanged)="toggleSelection($event)"
      />
      }
    </div>

    <div class="divider"></div>

    <!-- PAGADAS -->
    @if (paidMine().length > 0) {
    <h3 class="text-sm font-semibold text-gray-500 mt-4 mb-1">Pagadas</h3>
    <div class="space-y-2 opacity-60 pointer-events-none">
      @for (order of paidMine(); track order.publicId) {
      <app-payable-order-card
        [order]="order"
        [paid]="isPaid(order)"
        [selected]="false"
      />
      }
    </div>
    } }

    <!-- MESA -->
    @if (active() === 'table') {

    <!-- IMPAGAS -->
    <h3 class="text-sm font-semibold text-gray-500 mt-2 mb-1">Pendientes</h3>
    <div class="space-y-2">
      @for (order of unpaidTable(); track order.publicId) {
      <app-payable-order-card
        [order]="order"
        [paid]="isPaid(order)"
        [selected]="selectedOrders().includes(order.publicId)"
        (selectionChanged)="toggleSelection($event)"
      />
      }
    </div>

    <div class="divider"></div>

    <!-- PAGADAS -->
    @if (paidTable().length > 0) {
    <h3 class="text-sm font-semibold text-gray-500 mt-4 mb-1">Pagadas</h3>
    <div class="space-y-2 opacity-60 pointer-events-none">
      @for (order of paidTable(); track order.publicId) {
      <app-payable-order-card
        [order]="order"
        [paid]="isPaid(order)"
        [selected]="false"
      />
      }
    </div>
    } }
  </div>

  <div
    class="fixed bottom-25 left-0 right-0 bg-base-100 border-t border-base-300 px-4 py-3 shadow-lg"
  >
    <div class="max-w-3xl mx-auto">
      <div class="flex justify-between font-bold mb-2">
        <span>Total a pagar:</span>
        <span>${{ total() | number:'1.2-2' }}</span>
      </div>
      <button
        class="btn btn-primary w-full"
        [disabled]="selectedOrders().length === 0"
        (click)="pay()"
      >
        Pagar seleccionados
      </button>
    </div>
  </div>
</section>
